<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhonghe.apporder.mapper.OrderMapper">

    <select id="selectSalesOrderListByUser" resultType="com.zhonghe.apporder.model.SalesOrder">
        SELECT
        id,
        tenantId,
        memberId,
        memberName,
        customerId,
        customerName,
        customerAddr,
        orderDate,
        orderStatus,
        totalAmount,
        memo,
        deleted,
        createTime
        FROM
        omssalesorder
        WHERE
        memberId = #{userId}
        AND tenantId = #{tenantId}
        AND deleted = '0'
        <if test="customerName != null and customerName != ''">
            AND customerName LIKE CONCAT('%', #{customerName}, '%')
        </if>
        <if test="orderStatus != null and orderStatus != ''">
            AND orderStatus = #{orderStatus}
        </if>
        <if test="startDate != null and startDate != ''">
            AND orderDate >= #{startDate}
        </if>
        <if test="endDate != null and endDate != ''">
            AND orderDate <![CDATA[ <= ]]> #{endDate}
        </if>
        ORDER BY
        createTime DESC
        LIMIT
        #{offset}, #{pageSize}
    </select>

    <select id="selectSalesOrderCountByUser" resultType="java.lang.Long">
        SELECT
        COUNT(*)
        FROM
        omssalesorder
        WHERE
        memberId = #{userId}
        AND tenantId = #{tenantId}
        AND deleted = '0'
        <if test="customerName != null and customerName != ''">
            AND customerName LIKE CONCAT('%', #{customerName}, '%')
        </if>
        <if test="orderStatus != null and orderStatus != ''">
            AND orderStatus = #{orderStatus}
        </if>
        <if test="startDate != null and startDate != ''">
            AND orderDate >= #{startDate}
        </if>
        <if test="endDate != null and endDate != ''">
            AND orderDate <![CDATA[ <= ]]> #{endDate}
        </if>
    </select>
    <select id="selectByIdAndTenantId" resultType="com.zhonghe.apporder.model.SalesOrder">
        SELECT * FROM omssalesorder
        WHERE id = #{id} AND tenantId = #{tenantId} AND deleted = 0
    </select>
    <insert id="insert" parameterType="com.zhonghe.apporder.model.SalesOrder">
        INSERT INTO omssalesorder (
            id, tenantId, memberId, memberName,
            customerId, customerName, customerAddr,
            orderDate, orderStatus, totalAmount, memo,creator,createTime
        ) VALUES (
                     #{id}, #{tenantId}, #{memberId}, #{memberName},
                     #{customerId}, #{customerName}, #{customerAddr},
                     #{orderDate}, #{orderStatus}, #{totalAmount}, #{memo},#{creator},#{createTime}
                 )
    </insert>
    <update id="update" parameterType="com.zhonghe.apporder.model.SalesOrder">
        UPDATE omssalesorder
        <set>
            <if test="customerId != null">customerId = #{customerId},</if>
            <if test="customerName != null">customerName = #{customerName},</if>
            <if test="customerAddr != null">customerAddr = #{customerAddr},</if>
            <if test="orderStatus != null">orderStatus = #{orderStatus},</if>
            <if test="orderDate != null">orderDate = #{orderDate},</if>
            <if test="totalAmount != null">totalAmount = #{totalAmount},</if>
            <if test="memo != null">memo = #{memo},</if>
            <if test="updater != null">updater = #{updater},</if>
            <if test="updateTime != null">updateTime = #{updateTime},</if>
        </set>
        WHERE id = #{id} AND tenantId = #{tenantId}
    </update>
</mapper>