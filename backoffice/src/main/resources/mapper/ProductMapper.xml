<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhonghe.backoffice.mapper.ItemMapper">

    <!-- 通用查询结果映射 -->
    <resultMap id="BaseResultMap" type="com.zhonghe.backoffice.model.Item">
        <id column="HCid" property="HCid" jdbcType="VARCHAR"/>
        <result column="code" property="code" jdbcType="VARCHAR"/>
        <result column="name" property="name" jdbcType="VARCHAR"/>
        <result column="bar_code" property="barCode" jdbcType="VARCHAR"/>
        <result column="provider_no" property="providerNo" jdbcType="VARCHAR"/>
        <result column="provider_Number" property="providerNumber" jdbcType="VARCHAR"/>
        <result column="provider_Name" property="providerName" jdbcType="VARCHAR"/>
        <result column="brand_id" property="brandId" jdbcType="VARCHAR"/>
        <result column="brand_Number" property="brandNumber" jdbcType="VARCHAR"/>
        <result column="brand_Name" property="brandName" jdbcType="VARCHAR"/>
        <result column="producer" property="producer" jdbcType="VARCHAR"/>
        <result column="modal_id" property="modalId" jdbcType="VARCHAR"/>
        <result column="kind_id" property="kindId" jdbcType="VARCHAR"/>
        <result column="kind_Name" property="kindName" jdbcType="VARCHAR"/>
        <result column="kind_Number" property="kindNumber" jdbcType="VARCHAR"/>
        <result column="unit" property="unit" jdbcType="VARCHAR"/>
        <result column="medium_unit" property="mediumUnit" jdbcType="VARCHAR"/>
        <result column="max_unit" property="maxUnit" jdbcType="VARCHAR"/>
        <result column="medium_unit_num" property="mediumUnitNum" jdbcType="INTEGER"/>
        <result column="max_unit_num" property="maxUnitNum" jdbcType="INTEGER"/>
        <result column="company" property="company" jdbcType="VARCHAR"/>
        <result column="company_Name" property="companyName" jdbcType="VARCHAR"/>
        <result column="company_Number" property="companyNumber" jdbcType="VARCHAR"/>
        <result column="create_date" property="createDate" jdbcType="TIMESTAMP"/>
        <result column="update_date" property="updateDate" jdbcType="TIMESTAMP"/>
    </resultMap>

    <!-- 查询商品列表（带分页） -->
    <select id="selectItems" resultMap="BaseResultMap">
        SELECT *
        FROM AT_Item
        WHERE deleted = false
        <if test="name != null and name != ''">
            AND name LIKE CONCAT('%', #{name}, '%')
        </if>
        ORDER BY create_date DESC
        LIMIT #{offset}, #{pageSize}
    </select>

    <!-- 根据ID查询商品 -->
    <select id="selectById" resultMap="BaseResultMap">
        SELECT *
        FROM product
        WHERE HCid = #{HCid}
          AND deleted = false
    </select>

    <!-- 插入商品 -->
    <insert id="insertItem" parameterType="com.zhonghe.backoffice.model.Item">
        INSERT INTO product (
            HCid, code, name, bar_code, provider_no, provider_Number,
            provider_Name, brand_id, brand_Number, brand_Name, producer,
            modal_id, kind_id, kind_Name, kind_Number, unit, medium_unit,
            max_unit, medium_unit_num, max_unit_num, company, company_Name,
            company_Number, create_date, update_date
        ) VALUES (
                     #{HCid}, #{code}, #{name}, #{barCode}, #{providerNo}, #{providerNumber},
                     #{providerName}, #{brandId}, #{brandNumber}, #{brandName}, #{producer},
                     #{modalId}, #{kindId}, #{kindName}, #{kindNumber}, #{unit}, #{mediumUnit},
                     #{maxUnit}, #{mediumUnitNum}, #{maxUnitNum}, #{company}, #{companyName},
                     #{companyNumber}, #{createDate}, #{updateDate}
                 )
    </insert>

    <!-- 更新商品 -->
    <update id="updateItem" parameterType="com.zhonghe.backoffice.model.Item">
        UPDATE product
        SET
            code = #{code},
            name = #{name},
            bar_code = #{barCode},
            provider_no = #{providerNo},
            provider_Number = #{providerNumber},
            provider_Name = #{providerName},
            brand_id = #{brandId},
            brand_Number = #{brandNumber},
            brand_Name = #{brandName},
            producer = #{producer},
            modal_id = #{modalId},
            kind_id = #{kindId},
            kind_Name = #{kindName},
            kind_Number = #{kindNumber},
            unit = #{unit},
            medium_unit = #{mediumUnit},
            max_unit = #{maxUnit},
            medium_unit_num = #{mediumUnitNum},
            max_unit_num = #{maxUnitNum},
            company = #{company},
            company_Name = #{companyName},
            company_Number = #{companyNumber},
            update_date = #{updateDate}
        WHERE HCid = #{HCid}
    </update>

    <!-- 删除商品（逻辑删除） -->
    <update id="deleteById">
        UPDATE product
        SET deleted = true,
            update_date = NOW()
        WHERE HCid = #{HCid}
    </update>

    <!-- 商品数量统计 -->
    <select id="countItems" resultType="int">
        SELECT COUNT(*)
        FROM product
        WHERE deleted = false
        <if test="name != null and name != ''">
            AND name LIKE CONCAT('%', #{name}, '%')
        </if>
    </select>
</mapper>